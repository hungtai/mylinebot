<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>組織成長時間軸 - 互動事件動畫</title>
<style>
body { 
  font-family: Arial, sans-serif; 
  background: linear-gradient(135deg,#667eea 0%,#764ba2 100%); 
  margin:0; 
  padding:20px; 
  min-height:100vh; 
  box-sizing: border-box;
}
h1 { 
  text-align:center; 
  margin-bottom:32px; 
  color:#fff; 
  text-shadow:1px 1px 2px rgba(0,0,0,0.22); 
  font-size:2em;
}
.container { 
  max-width:1150px; 
  margin:0 auto; 
}
.timeline-section { 
  background: rgba(255,255,255,0.15); 
  backdrop-filter: blur(9px); 
  border-radius:20px; 
  padding:32px 20px 24px 20px; 
  margin-bottom:18px; 
  box-shadow:0 6px 22px rgba(0,0,0,0.09); 
}
.timeline-container { 
  position:relative; 
  width:100%; 
  height:310px;
  min-height:240px;
  max-height:340px;
  overflow:visible;
}
.center-display { 
  position:absolute; 
  top:35px; 
  left:50%; 
  background: linear-gradient(45deg,#ff6b6b,#feca57); 
  color:white; 
  padding:18px 32px; 
  border-radius:20px; 
  box-shadow:0 7px 23px rgba(0,0,0,0.15); 
  text-align:center; 
  min-width:255px; 
  font-size: 1.18em;
  opacity:0; 
  transform:translateX(-50%) scale(0.88); 
  transition: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  z-index:2;
  pointer-events: none;
}
.center-display.show { opacity:1; transform:translateX(-50%) scale(1); pointer-events: auto;}
.center-display.hide { opacity:0; transform:translateX(-50%) scale(0.8) translateY(110px); }
.center-year { font-size:1.65em; font-weight:bold; margin-bottom:5px; line-height:1; }
.center-event { font-size:1.05em; }
.center-category { font-size:0.95em; margin-top:7px; background: rgba(255,255,255,0.18); padding:5px 16px; border-radius:13px; display:inline-block; }
.timeline { 
  position:absolute; 
  bottom:60px; 
  width:98%; 
  left:1%;
  height:52px; 
  border-bottom:2.8px solid rgba(255,255,255,0.82); 
}
.event { 
  position:absolute; 
  bottom:-8px; 
  width:18px; 
  height:18px; 
  background: linear-gradient(45deg,#ff6b6b,#feca57); 
  border-radius:50%; 
  transition: all 0.38s ease; 
  opacity:0; 
  transform: scale(0); 
  cursor: pointer; 
  z-index:1;
}
.event.animate { opacity:1; transform: scale(1); }
.event:hover { transform: scale(1.22); box-shadow: 0 0 15px rgba(255, 107, 107, 0.35); }
.label-year { 
  position:absolute; 
  bottom:-28px; 
  transform:translateX(-50%); 
  color:#fff; 
  font-weight:bold; 
  font-size:1.08em; 
  opacity:0; 
  transition: opacity 0.4s ease; 
}
.label-line { 
  position:absolute; 
  width:1.3px; 
  background:#fff; 
  bottom:10px; 
  transition: height 0.52s ease; 
}
.label-text { 
  position:absolute; 
  color:#fff; 
  font-size:0.90em; 
  font-weight:bold; 
  white-space:nowrap; 
  opacity:0; 
  transition: all 0.36s ease; 
}
.label-text.animate { opacity:1; }
.controls { 
  text-align:center; 
  margin:16px 0 10px 0; 
}
.btn { 
  background: linear-gradient(45deg,#667eea,#764ba2); 
  color:white; 
  border:none; 
  padding:12px 26px; 
  margin:0 12px; 
  border-radius:21px; 
  cursor:pointer; 
  font-size:1.1em; 
  transition: all 0.25s ease; 
}
.btn:hover { transform: translateY(-1px); }
.btn:disabled { opacity:0.64; cursor:not-allowed; }
.progress-bar { 
  width:100%; 
  height:4px; 
  background: rgba(255,255,255,0.26); 
  border-radius:2px; 
  margin:13px 0; 
}
.progress-fill { 
  height:100%; 
  background: linear-gradient(45deg,#ff6b6b,#feca57); 
  width:0%; 
  transition: width 1.25s cubic-bezier(0.4,0,0.2,1); 
}
.table-section { 
  background: rgba(255,255,255,0.96); 
  border-radius:17px; 
  padding:20px 8px 24px 8px; 
  margin-top:10px; 
  max-width: 930px;
  margin-left:auto;
  margin-right:auto;
  font-size: 1.05em;
}
.events-table { width:100%; border-collapse: collapse; font-size: 1.02em; }
.events-table thead { background: linear-gradient(45deg,#667eea,#764ba2); color:white; font-size: 1.08em;}
.events-table th, .events-table td { padding:11px 13px; border-bottom:1px solid #eee; }
.year-cell { font-weight:bold; color:#667eea; }
.show { opacity:1; transition: opacity 0.5s ease; }
.instruction { 
  text-align: center; 
  color: rgba(255,255,255,0.84); 
  font-size: 1.01em; 
  margin-bottom: 14px; 
}
@media (max-width: 950px) {
  .container, .table-section { max-width: 99vw; }
  .timeline-section { padding: 13px 2px 14px 2px;}
  .timeline-container { height:170px; min-height:100px; }
  .center-display { min-width:92px; font-size: 0.73em; padding:6px 6px; top:10px;}
  .timeline { height:19px; font-size:0.7em;}
  .label-year, .label-text { font-size:0.68em; }
  .table-section { font-size:0.75em; padding:7px 1px 10px 1px;}
}
::-webkit-scrollbar { width:0!important; background:transparent!important; }
</style>
</head>
<body>
<div class="container">
  <h1>組織成長時間軸</h1>
  <div class="timeline-section">
    <div class="instruction">點擊「開始動畫」觀看時間軸發展過程</div>
    <div class="controls">
      <button class="btn" onclick="startAnimation()" id="startBtn">開始動畫</button>
      <button class="btn" onclick="resetAnimation()">重新開始</button>
      <button class="btn" onclick="showTable()">顯示表格</button>
    </div>
    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
    <div class="timeline-container">
      <div class="center-display" id="centerDisplay">
        <div class="center-year" id="centerYear"></div>
        <div class="center-event" id="centerEvent"></div>
        <div class="center-category" id="centerCategory"></div>
      </div>
      <div class="timeline" id="timeline"></div>
    </div>
  </div>
  <div class="table-section" id="tableSection" style="display:none;">
    <h2>組織發展里程碑</h2>
    <table class="events-table">
      <thead><tr><th>年度</th><th>重要事件</th><th>類別</th></tr></thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>
</div>
<script>
let data=[
{year:"1999",remark:"進入公司",category:"人事"},
{year:"2000",remark:"FAB1 自動派送功能",category:"系統建置"},
{year:"2002",remark:"建立獨立MES/MCS標準",category:"標準建立"},
{year:"2002",remark:"獨立符合SEMI標準的AMHS",category:"標準建立"},
{year:"2005",remark:"完成FAB5 CIM建置",category:"系統建置"},
{year:"2007",remark:"獨立LCM建 3-tier架構",category:"架構設計"},
{year:"2008",remark:"獨立LCM建 3-tier架構",category:"架構設計"},
{year:"2010",remark:"建立AT團隊光學部門",category:"組織發展"},
{year:"2013",remark:"建立CIM 影像小組",category:"組織發展"},
{year:"2014",remark:"建立CIM 影像小組",category:"組織發展"},
{year:"2017",remark:"第一版Rule-based ADJ上線",category:"技術突破"},
{year:"2018",remark:"高頻EDC資料系統研製上線",category:"系統建置"},
{year:"2019",remark:"AI ADJ 上線",category:"AI技術"},
{year:"2022",remark:"ADB DES",category:"系統升級"},
{year:"2024",remark:"AI ADR",category:"AI技術"}];

let timelineElements=[], animationIndex=0, isAnimating=false;
let lastLayerIndex = -1;
let clickTimeout;

function getNextLayer(layers){
    lastLayerIndex = (lastLayerIndex + 1) % layers.length;
    return layers[lastLayerIndex];
}

function initTimeline(){
    const timeline=document.getElementById('timeline');
    const tableBody=document.getElementById('tableBody');
    timeline.innerHTML=''; timelineElements=[];
    const minYear=Math.min(...data.map(d=>parseInt(d.year)));
    const maxYear=Math.max(...data.map(d=>parseInt(d.year)));
    const span=maxYear-minYear;
    // 高度層級有精緻編排
    const layers=[50,80,110,140];
    const offsetStep=17;
    let yearCountMap={};
    let yearSet=new Set();

    data.sort((a,b)=>parseInt(a.year)-parseInt(b.year)).forEach(item=>{
        const yearNum=parseInt(item.year);
        const percent=((yearNum-minYear)/span)*90+5;

        // 避免重複年度
        let yearLabel=null;
        if(!yearSet.has(item.year)){
            yearLabel=document.createElement('div');
            yearLabel.className='label-year';
            yearLabel.style.left=percent+'%';
            yearLabel.textContent=item.year;
            timeline.appendChild(yearLabel);
            yearSet.add(item.year);
        }

        const eventEl=document.createElement('div');
        eventEl.className='event';
        eventEl.style.left=percent+'%';
        eventEl.addEventListener('click',()=>showClickedEvent(item));
        timeline.appendChild(eventEl);

        if(!yearCountMap[item.year]) yearCountMap[item.year]=0;
        const topPx=getNextLayer(layers);
        let offset=((yearCountMap[item.year] % 2 === 0 ? 1 : -1) * Math.floor(yearCountMap[item.year]/2) * offsetStep);
        yearCountMap[item.year]++;

        const lineEl=document.createElement('div');
        lineEl.className='label-line';
        lineEl.style.left=(percent+offset)+'%';
        lineEl.style.height='0px';
        timeline.appendChild(lineEl);

        const textEl=document.createElement('div');
        textEl.className='label-text';
        textEl.style.left=(percent+offset)+'%';
        textEl.style.bottom=topPx+'px';
        textEl.textContent=item.remark;
        timeline.appendChild(textEl);

        timelineElements.push({event:eventEl,line:lineEl,label:textEl,labelBottom:topPx,yearLabel:yearLabel,data:item});
    });

    tableBody.innerHTML='';
    data.forEach(item=>{
        const row=document.createElement('tr');
        row.innerHTML=`<td class="year-cell">${item.year}</td><td>${item.remark}</td><td><span style="background:linear-gradient(45deg,#667eea,#764ba2);color:white;padding:4px 10px;border-radius:9px;">${item.category}</span></td>`;
        tableBody.appendChild(row);
    });
}

function showClickedEvent(eventData){
    if(isAnimating) return;
    const center=document.getElementById('centerDisplay');
    if(!center) return;
    if(clickTimeout) clearTimeout(clickTimeout);

    showCenterDisplay(eventData);

    clickTimeout=setTimeout(()=>{
        center.classList.remove('show');
        center.classList.add('hide');
        setTimeout(()=>center.classList.remove('hide'),600);
    },1850);
}

function startAnimation(){
    if(isAnimating) return;
    resetAnimation();
    isAnimating=true; animationIndex=0;
    document.getElementById('startBtn').disabled=true;
    document.getElementById('startBtn').textContent='動畫進行中...';
    const tableRows=document.querySelectorAll('#tableBody tr');

    function animateNext(){
        if(animationIndex>=data.length){
            isAnimating=false;
            document.getElementById('startBtn').disabled=false;
            document.getElementById('startBtn').textContent='開始動畫';
            return;
        }
        const current=timelineElements[animationIndex];
        if(!current||!current.data){ animationIndex++; animateNext(); return; }

        document.getElementById('progressFill').style.width=`${((animationIndex+1)/data.length)*100}%`;
        showCenterDisplay(current.data);

        setTimeout(()=>{
            const center=document.getElementById('centerDisplay');
            center.classList.remove('show'); center.classList.add('hide');

            setTimeout(()=>{
                if(current.event) current.event.classList.add('animate');
                if(current.yearLabel) current.yearLabel.style.opacity='1';
                if(current.label) current.label.classList.add('animate');

                const circleRadius=9;
                if(current.line){
                    current.line.style.height='0px';
                    setTimeout(()=>{ current.line.style.height=(current.labelBottom+circleRadius)+'px'; },32);
                }

                if(tableRows[animationIndex]) setTimeout(()=>tableRows[animationIndex].classList.add('show'),200);

                animationIndex++;
                animateNext();
            },620);
        },1650);
    }
    animateNext();
}

function showCenterDisplay(d){
    const center=document.getElementById('centerDisplay');
    center.classList.remove('show','hide');
    setTimeout(()=>{
        document.getElementById('centerYear').textContent=d.year;
        document.getElementById('centerEvent').textContent=d.remark;
        document.getElementById('centerCategory').textContent=d.category;
        center.classList.add('show');
    },40);
}

function resetAnimation(){
    isAnimating=false; animationIndex=0; lastLayerIndex=-1;
    document.getElementById('startBtn').disabled=false;
    document.getElementById('startBtn').textContent='開始動畫';
    document.getElementById('progressFill').style.width='0%';
    const center=document.getElementById('centerDisplay');
    center.classList.remove('show','hide');
    if(clickTimeout){ clearTimeout(clickTimeout); clickTimeout=null; }
    timelineElements.forEach(e=>{
        if(e.event) e.event.className='event';
        if(e.label) e.label.className='label-text';
        if(e.line) e.line.style.height='0px';
        if(e.yearLabel) e.yearLabel.style.opacity='0';
    });
    document.querySelectorAll('#tableBody tr').forEach(r=>r.className='');
}

function showTable(){
    const t=document.getElementById('tableSection');
    t.style.display='block';
    t.scrollIntoView({behavior:'smooth'});
    document.querySelectorAll('#tableBody tr').forEach((row,i)=>{
        setTimeout(()=>row.classList.add('show'),i*60);
    });
}

window.addEventListener('DOMContentLoaded',initTimeline);
</script>
</body>
</html>